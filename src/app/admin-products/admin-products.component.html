<h6 class="admin-title mb-3">Manage Products</h6>

<div class="container">
  <div class="row d-flex justify-content-between align-items-center">
    <div class="col-sm-8 col-lg-7 col-xl-5 pl-0">
      <div class="row no-gutters">
        <div class="search input-group col mr-1">
          <label for="searchInput" class="sr-only">Search Product</label>
          <input type="search" class="form-control form-control-sm border-right-0" id="searchInput" aria-describedby="searchProduct" placeholder="Search Product Name" [(ngModel)]="searchText">
          <span class="input-group-append">
            <div class="input-group-text bg-transparent"><i class="fas fa-search"></i></div>
          </span>
        </div>
        <div class="btn-group col-auto" role="group">
          <button type="button" class="btn btn-outline-secondary btn-sm btn-light bg-transparent text-dark border rounded-border-25" data-toggle="modal" data-target="#sortFilterModal"><i class="fas fa-sort"></i></button>
          <button type="button" class="btn btn-outline-secondary btn-sm btn-light bg-transparent text-dark border rounded-border-25" (click)="toggleView()">
            <i class="fas fa-list" *ngIf="!viewAsList"></i>
            <i class="fas fa-th" *ngIf="viewAsList"></i>
          </button>
        </div>
      </div>
    </div>
    <div class="col-3 text-right">
      <a class="btn btn-info btn-sm" [routerLink]="['/admin/products/create']"><i class="fas fa-plus"></i> Add Product</a>
    </div>
  </div>
  <div class="row mt-3">
    <span class="results-text text-uppercase text-nowrap">Showing all {{ noOfProducts }} results</span>
  </div>
  <div class="row mt-1 bg-white">
    <div class="table-responsive" *ngIf="viewAsList">
      <table class="table table-hover">
        <thead>
          <tr>
            <th scope="col">Product</th>
            <th scope="col">Category</th>
            <th scope="col">Price</th>
            <th scope="col">Stock</th>
            <th scope="col">Bestseller</th>
            <th scope="col">Delete</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let product of products | filter : searchText">
            <th scope="row" [routerLink]="['/admin/products', product._id]" routerLinkActive="router-link-active" routerLink="/admin/products/{{product._id}}" routerLinkActive="router-link-active" class="underline pointer">{{ product.name }}</th>
            <td>{{ product.category[0].name }}</td>
            <td>{{ (product.price/100) | currency:'NZD' }}</td>
            <td class="text-truncate" style="max-width: 150px;">{{ product.stock }}</td>
            <td><i class="far fa-check-square" *ngIf="product.isBestseller"></i></td>
            <td class="text-danger"><i class="fas fa-minus-circle pointer" (click)="selectProduct(product._id, product.name)" data-toggle="modal" data-target="#deleteProductModal"></i></td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="container d-flex flex-wrap justify-content-around mt-3" *ngIf="!viewAsList">
      <div class="card border-light" *ngFor="let product of products | filter : searchText">
        <img class="card-img-top img-fluid" *ngIf="product.image" src="{{ product.image }}" alt="Plant image">
        <img class="card-img-top img-fluid" *ngIf="!product.image" src="../../assets/default-plant.jpg" alt="Plant image">
        <div class="card-badge" *ngIf="product.isBestseller">
          <span class="badge badge-secondary float-right">Bestseller</span>
        </div>
        <div class="card-badge" *ngIf="product.stock <= 0">
          <span class="badge badge-danger float-right">Out of Stock</span>
        </div>
        <div class="card-body">
          <h6 class="card-title text-truncate">{{ product.name }} | <small class="text-muted">{{ product.category[0].name }}</small></h6>
          <span class="price">{{ (product.price/100) | currency:'NZD' }}</span>
          <p class="card-text text-muted text-truncate">{{ product.description }}</p>
          <a [routerLink]="['/admin/products', product._id]" routerLinkActive="router-link-active" routerLink="/admin/products/{{product._id}}" routerLinkActive="router-link-active" class="btn btn-black text-uppercase">Edit Plant</a>
          &nbsp;<a (click)="selectProduct(product._id, product.name)" data-toggle="modal" data-target="#deleteProductModal" class="text-muted bg-transparent"><i class="fas fa-trash-alt"></i></a>
        </div>
      </div>
    </div>

  </div>
</div>
<div class="justify-content-center bg-white" *ngIf="isProductsLoading">
  <img class="loading-img" src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="> Retrieving products
</div>
<div class="justify-content-center bg-white" *ngIf="(products)?.length === 0">
  No products available.
</div>
<button type="button" class="btn btn-danger btn-sm add-btn my-4" *ngIf="(products)?.length > 0" data-toggle="modal" data-target="#deleteAllProductsModal"><i class="fas fa-trash-alt"></i> Delete All Products</button>

<!-- Delete Product Modal -->
<div class="modal fade" id="deleteProductModal" tabindex="-1" role="dialog" aria-labelledby="deleteProductTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteProductTitle">Delete Product</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete product <strong>{{ selectedProductName }}</strong>?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="deleteProduct()">Delete</button>
      </div>
    </div>
  </div>
</div>

<!-- Delete All Products Modal -->
<div class="modal fade" id="deleteAllProductsModal" tabindex="-1" role="dialog" aria-labelledby="deleteAllProductsTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteAllProductsTitle">Delete All Products</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete all products?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="deleteAllProducts()">Delete</button>
      </div>
    </div>
  </div>
</div>

<!-- Sort / Filter Modal -->
<div class="modal fade" id="sortFilterModal" tabindex="-1" role="dialog" aria-labelledby="sortFilterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="sortFilterTitle">Refine Results</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <h6 class="text-uppercase text-left">Sort by</h6>
        <div class="sort-by">
          <nav aria-label="Pagination">
            <ul class="pagination" id="sortByOptions">
              <li class="page-item active text-nowrap" id="{{ SORT_BY_PRODUCT_A_TO_Z }}" (click)="selectSortBy(SORT_BY_PRODUCT_A_TO_Z)"><a class="page-link">Product Name (a - z)</a></li>
              <li class="page-item text-nowrap" id="{{ SORT_BY_PRODUCT_Z_TO_A }}" (click)="selectSortBy(SORT_BY_PRODUCT_Z_TO_A)"><a class="page-link">Product Name (z - a)</a></li>
              <li class="page-item text-nowrap" id="{{ SORT_BY_PRICE_LOW_TO_HIGH }}" (click)="selectSortBy(SORT_BY_PRICE_LOW_TO_HIGH)"><a class="page-link">Price (low - high)</a></li>
              <li class="page-item text-nowrap" id="{{ SORT_BY_PRICE_HIGH_TO_LOW }}" (click)="selectSortBy(SORT_BY_PRICE_HIGH_TO_LOW)"><a class="page-link">Price (high - low)</a></li>
            </ul>
          </nav>
        </div>
        <hr>
        <h6 class="text-left">
          <span class="text-uppercase">Plant Category</span>
          <small>
            <a class="float-right underline text-dark pointer" tabindex="-1" (click)="checkAllCategories(false)" *ngIf="isCheckAllCategories">Remove All</a>
            <a class="float-right underline text-dark pointer" tabindex="-1" (click)="checkAllCategories(true)" *ngIf="!isCheckAllCategories">Select All</a>
          </small>
        </h6>
        <div class="form-check justify-content-between text-left mr-3 my-2" *ngFor="let category of categories; index as i">
          <label class="form-check-label" for="checkBox">
            <span *ngIf="category.parent!==null">&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span *ngIf="category.parent!==null && category.parent.parent!==null">&nbsp;&nbsp;&nbsp;&nbsp;</span>
            {{ category.name }}
          </label>
          <input class="form-check-input checkbox-category" type="checkbox" id="{{ category._id }}" (click)="clickCategory(category._id, i)" [(ngModel)]="isCategoryChecked[i]">
        </div>
        <hr>
        <h6 class="text-left">
          <span class="text-uppercase">Filter</span>
          <small>
            <a class="float-right underline text-dark pointer" tabindex="-1" (click)="checkAllFilters(false)" *ngIf="isCheckAllFilters">Remove All</a>
            <a class="float-right underline text-dark pointer" tabindex="-1" (click)="checkAllFilters(true)" *ngIf="!isCheckAllFilters">Select All</a>
          </small>
        </h6>
        <div class="form-check justify-content-between text-left mr-3 my-2">
          <label class="form-check-label" for="checkBox">Bestseller</label>
          <input class="form-check-input" type="checkbox" id="checkbox-bestseller" [(ngModel)]="isBestsellerChecked" (click)="clickFilter()">
        </div>
        <div class="form-check justify-content-between text-left mr-3 my-2">
          <label class="form-check-label" for="checkBox">Out of Stock</label>
          <input class="form-check-input" type="checkbox" id="checkbox-soldout" [(ngModel)]="isSoldoutChecked" (click)="clickFilter()">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="applyFilter()">Apply Filters</button>
      </div>
    </div>
  </div>
</div>
